#! /bin/sh

display_error (){

        exit
}

. ~/.config/mynotes/mynotes.conf

if [ $# = 0 ]; then 
	cd $NOTES_ROOT
	vim -S "$CONFIG_DIR/vim/notes.vim" . 
elif [ $# = 1 ]; then
	if [ $1 = 'journal' ]; then  
		cd $JOURNAL_ROOT
		vim -S "$CONFIG_DIR/vim/notes.vim" . 
	elif [ $1 = 'jot' ]; then  
		cd $NOTES_ROOT
		vim -S "$CONFIG_DIR/vim/notes.vim" "$DEFAULT_NOTEBOOK/jot.md"
	fi
elif [ $# = 2 ]; then
	if [ $1 = 'open' ] 
	then 
		cd "$NOTES_ROOT"
		vim -S "$CONFIG_DIR/vim/notes.vim" "$NOTES_ROOT/$2" 
	fi
elif [ $# = 3 -a $1 = 'add' ]; then
	if [ $2 = 'notebook' ]; then 
		mkdir -p "$NOTES_ROOT/$3"
		#echo 'notebook'
	elif [ $2 = 'note' ]; then 
		TITLE=`echo $3 | tr -s '[:space:]' | sed -e "s/\b\(.\)/\u\1/g"`
		FILENAME=`echo $3 | sed  's/[[:space:]]/_/g;s/-/_/g;s/[^[:alnum:]_-/]//g;s/_\+/_/g' | tr '[:upper:]' '[:lower:]'`
		FILENAME="$FILENAME$EXTENSION"
		cd $NOTES_ROOT
		echo "# $TITLE" > $FILENAME
		echo "" >> $FILENAME
		echo "Time: $TIMESTAMP" >> $FILENAME
		echo "" >> $FILENAME
		vim  -S "$CONFIG_DIR/vim/notes.vim"  +$ "$FILENAME"
	elif [ $2 = 'journal' ]; then 
		#underscores are better than dashes
		cd $JOURNAL_ROOT
		FILENAME=`echo $3 | sed  's/[[:space:]]/_/g;s/-/_/g;s/[^[:alnum:]_-/]//g;s/_\+/_/g' | tr '[:upper:]' '[:lower:]'`
		TITLE=`echo $3 | tr -s '[:space:]' | sed -e "s/\b\(.\)/\u\1/g"`
		#echo "$FILENAME"
		#echo "$TITLE"
		FILENAME="$JOURNAL_ROOT/$TIMESTAMP_FILE"_"$FILENAME$EXTENSION"
		echo "# $TITLE" > $FILENAME
		echo "" >> $FILENAME
		echo "Time: $TIMESTAMP" >> $FILENAME
		echo "" >> $FILENAME
		vim -S "$CONFIG_DIR/vim/journal.vim" +$ $FILENAME
	fi 

fi
